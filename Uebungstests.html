<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√úbungstests</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #333;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 1.1rem;
    }

    .back-link {
      position: absolute;
      top: 0;
      left: 0;
      color: #667eea;
      text-decoration: none;
      font-size: 1.1rem;
      padding: 10px 15px;
      border-radius: 8px;
      transition: all 0.3s;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .back-link:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    .section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .section h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sets-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .set-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      border: 3px solid transparent;
    }

    .set-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .set-card.selected {
      border-color: #ffd700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .set-card h3 {
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    .set-card p {
      opacity: 0.9;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .set-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .checkbox-indicator {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.5);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .set-card.selected .checkbox-indicator {
      background: #ffd700;
      border-color: #ffd700;
      color: #333;
    }

    .test-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .option-group {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #e9ecef;
    }

    .option-group h4 {
      color: #333;
      margin-bottom: 15px;
      font-size: 1rem;
    }

    .option-group label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: background 0.3s;
    }

    .option-group label:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    .option-group input[type="radio"] {
      accent-color: #667eea;
    }

    .option-group input[type="number"] {
      width: 80px;
      padding: 8px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    .start-test-btn {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      margin-top: 20px;
      opacity: 0.5;
      pointer-events: none;
    }

    .start-test-btn.enabled {
      opacity: 1;
      pointer-events: all;
    }

    .start-test-btn.enabled:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }

    .empty-state {
      text-align: center;
      color: #999;
      font-size: 1.2rem;
      margin-top: 50px;
    }

    .empty-state .icon {
      font-size: 4rem;
      margin-bottom: 20px;
    }

    .selected-count {
      background: #667eea;
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-block;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .sets-grid {
        grid-template-columns: 1fr;
      }
      
      .test-options {
        grid-template-columns: 1fr;
      }
      
      .back-link {
        position: relative;
        display: inline-block;
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="HauptSeite.html" class="back-link">‚¨Ö Zur√ºck zur Startseite</a>
    
    <div class="header">
      <h1>üìù √úbungstests</h1>
      <p>W√§hle Lernsets aus und teste dein Wissen</p>
    </div>

    <!-- Lernsets Auswahl -->
    <div class="section">
      <h2>üéØ Lernsets ausw√§hlen</h2>
      <div class="selected-count" id="selectedCount">0 Sets ausgew√§hlt</div>
      <div class="sets-grid" id="setsGrid">
        <!-- Wird dynamisch gef√ºllt -->
      </div>
      <div class="empty-state" id="noSets" style="display: none">
        <div class="icon">üì≠</div>
        Keine Lernsets verf√ºgbar
      </div>
    </div>

    <!-- Test Einstellungen -->
    <div class="section">
      <h2>‚öôÔ∏è Test-Einstellungen</h2>
      <div class="test-options">
        <div class="option-group">
          <h4>Test-Modus</h4>
          <label>
            <input type="radio" name="testMode" value="mixed" checked>
            Gemischt (Hin & Zur√ºck)
          </label>
          <label>
            <input type="radio" name="testMode" value="forward">
            Nur Quellsprache ‚Üí Zielsprache
          </label>
          <label>
            <input type="radio" name="testMode" value="backward">
            Nur Zielsprache ‚Üí Quellsprache
          </label>
        </div>

        <div class="option-group">
          <h4>Schwierigkeitsgrad</h4>
          <label>
            <input type="radio" name="difficulty" value="all" checked>
            Alle Schwierigkeitsgrade
          </label>
          <label>
            <input type="radio" name="difficulty" value="easy">
            Nur Einfach (Level 1-2)
          </label>
          <label>
            <input type="radio" name="difficulty" value="medium">
            Nur Mittel (Level 3)
          </label>
          <label>
            <input type="radio" name="difficulty" value="hard">
            Nur Schwer (Level 4-5)
          </label>
        </div>

        <div class="option-group">
          <h4>Anzahl Fragen</h4>
          <label>
            <input type="radio" name="questionCount" value="10" checked>
            10 Fragen
          </label>
          <label>
            <input type="radio" name="questionCount" value="20">
            20 Fragen
          </label>
          <label>
            <input type="radio" name="questionCount" value="50">
            50 Fragen
          </label>
          <label>
            <input type="radio" name="questionCount" value="custom">
            Eigene Anzahl: <input type="number" id="customCount" min="1" max="100" value="15">
          </label>
        </div>

        <div class="option-group">
          <h4>Test-Typ</h4>
          <label>
            <input type="radio" name="testType" value="input" checked>
            Eingabe (Tippen)
          </label>
          <label>
            <input type="radio" name="testType" value="choice">
            Multiple Choice
          </label>
          <label>
            <input type="radio" name="testType" value="flashcard">
            Karteikarten-Modus
          </label>
        </div>
      </div>

      <button class="start-test-btn" id="startTestBtn" onclick="startTest()">
        Test starten
      </button>
    </div>
  </div>

  <script>
    let selectedSets = new Set();
    let availableSets = [];

    // Lernsets laden
    function loadSets() {
      fetch('api_lernsets.php')
        .then(res => res.json())
        .then(data => {
          availableSets = data;
          const container = document.getElementById('setsGrid');
          const emptyState = document.getElementById('noSets');

          container.innerHTML = '';

          if (data.length === 0) {
            emptyState.style.display = 'block';
            return;
          }

          emptyState.style.display = 'none';

          data.forEach(set => {
            const div = document.createElement('div');
            div.className = 'set-card';
            div.dataset.setId = set.id;
            div.innerHTML = `
              <div class="checkbox-indicator">‚úì</div>
              <h3>${set.name}</h3>
              <p>${set.beschreibung || 'Keine Beschreibung'}</p>
              <div class="set-info">
                <span>üìö ${set.vocab_count || 0} Vokabeln</span>
                <span>üìÖ ${formatDate(set.created_at)}</span>
              </div>
            `;
            
            div.onclick = () => toggleSetSelection(set.id, div);
            container.appendChild(div);
          });
        })
        .catch(err => {
          console.error('Fehler beim Laden der Lernsets:', err);
        });
    }

    // Set-Auswahl umschalten
    function toggleSetSelection(setId, cardElement) {
      if (selectedSets.has(setId)) {
        selectedSets.delete(setId);
        cardElement.classList.remove('selected');
      } else {
        selectedSets.add(setId);
        cardElement.classList.add('selected');
      }
      
      updateSelectedCount();
      updateStartButton();
    }

    // Ausgew√§hlte Sets Counter aktualisieren
    function updateSelectedCount() {
      const count = selectedSets.size;
      const countElement = document.getElementById('selectedCount');
      countElement.textContent = `${count} Set${count !== 1 ? 's' : ''} ausgew√§hlt`;
    }

    // Start-Button aktivieren/deaktivieren
    function updateStartButton() {
      const startBtn = document.getElementById('startTestBtn');
      if (selectedSets.size > 0) {
        startBtn.classList.add('enabled');
        startBtn.textContent = `Test mit ${selectedSets.size} Set${selectedSets.size !== 1 ? 's' : ''} starten`;
      } else {
        startBtn.classList.remove('enabled');
        startBtn.textContent = 'Test starten';
      }
    }

    // Test starten
    function startTest() {
      if (selectedSets.size === 0) {
        alert('Bitte w√§hle mindestens ein Lernset aus!');
        return;
      }

      // Test-Einstellungen sammeln
      const testMode = document.querySelector('input[name="testMode"]:checked').value;
      const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
      const questionCountMode = document.querySelector('input[name="questionCount"]:checked').value;
      const testType = document.querySelector('input[name="testType"]:checked').value;
      
      let questionCount = 10;
      if (questionCountMode === 'custom') {
        questionCount = parseInt(document.getElementById('customCount').value) || 15;
      } else {
        questionCount = parseInt(questionCountMode);
      }

      // Parameter f√ºr Test-Seite zusammenstellen
      const params = new URLSearchParams({
        sets: Array.from(selectedSets).join(','),
        mode: testMode,
        difficulty: difficulty,
        count: questionCount,
        type: testType
      });

      // Zur Test-Seite weiterleiten
      window.location.href = `test.html?${params.toString()}`;
    }

    // Hilfsfunktion: Datum formatieren
    function formatDate(dateString) {
      if (!dateString) return 'Unbekannt';
      const date = new Date(dateString);
      return date.toLocaleDateString('de-DE', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }

    // Event Listener f√ºr Custom Count
    document.getElementById('customCount').addEventListener('input', function() {
      document.querySelector('input[name="questionCount"][value="custom"]').checked = true;
    });

    // Seite laden
    window.onload = function() {
      loadSets();
      updateSelectedCount();
      updateStartButton();
    };
  </script>
</body>
</html>